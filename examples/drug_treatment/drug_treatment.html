
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Tumor growth under drug treatment &#8212; LattiCS 0.post108.dev0+gf4c5261 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../_static/plot_directive.css?v=7f9a90b1" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css?v=81467e3f" />
  
  <!-- So that users can add custom icons -->
  <script src="../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../../_static/documentation_options.js?v=f2cdd6f8"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'examples/drug_treatment/drug_treatment';</script>
    <link rel="author" title="About these documents" href="../../about.html" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Learn about the methods behind LattiCS" href="../../learn/main.html" />
    <link rel="prev" title="Examples" href="../main.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="0.post108.dev0+gf4c5261" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/logo-light_s.png" class="logo__image only-light" alt="LattiCS 0.post108.dev0+gf4c5261 documentation - Home"/>
    <img src="../../_static/logo-dark_s.png" class="logo__image only-dark pst-js-only" alt="LattiCS 0.post108.dev0+gf4c5261 documentation - Home"/>
  
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../installation.html">
    Installation
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../main.html">
    Examples
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../learn/main.html">
    Learn
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../api/main.html">
    API
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../about.html">
    About
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../installation.html">
    Installation
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../main.html">
    Examples
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../learn/main.html">
    Learn
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../api/main.html">
    API
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../../about.html">
    About
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="../main.html"
                          title="previous chapter">Examples</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="../../learn/main.html"
                          title="next chapter">Learn about the methods behind LattiCS</a></p>
  </div></div>
        <div class="sidebar-primary-item">
<div id="searchbox"></div></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../main.html" class="nav-link">Examples</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">Tumor growth under drug treatment</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="tumor-growth-under-drug-treatment">
<h1>Tumor growth under drug treatment<a class="headerlink" href="#tumor-growth-under-drug-treatment" title="Link to this heading">#</a></h1>
<p>This example presents a simple model of tumor growth coupled with the administration of an antitumor drug. The original research and the modeling methodology are detailed in <a class="reference internal" href="#ref-drexler2020"><span class="std std-ref">Drexler et al. (2020)</span></a>.</p>
<section id="background">
<h2>Background<a class="headerlink" href="#background" title="Link to this heading">#</a></h2>
<p>The original paper’s experiments investigate the response of a murine breast cancer model to pegylated liposomal doxorubicin (PLD or Doxil) over a long time frame (approximately 80 to 250 days). The authors proposed a system of ordinary differential equations (ODEs) to describe the dynamics of tumor cells, necrotic cells, and drug levels in both the tumor tissue (central compartment) and peripheral organs (peripheral compartment). The drug treatment is modeled by instant changes to the drug levels in the central compartment at specific time points, corresponding to the actual injections administered in the in vivo experiment.</p>
<p>The equations of the mathematical model are as follows.</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{align*}
    \dot{x}_1 &amp;= (a - n) x_1 - b \frac{x_1 x_3}{ED_{50} + x_3} \\
    \dot{x}_2 &amp;= n x_1 + b \frac{x_1 x_3}{ED_{50} + x_3} - w x_2 \\
    \dot{x}_3 &amp;= -(c + k_1) x_3 + k_2 x_4 - b_k \frac{x_1 x_3}{ED_{50} + x_3} \\
    \dot{x}_4 &amp;= k_1 x_3 - k_2 x_4
\end{align*}\end{split}\]</div>
<p>Here, the state variables <span class="math notranslate nohighlight">\(x_1\)</span> and <span class="math notranslate nohighlight">\(x_2\)</span> represent the tumor tissue volume and the necrotic tissue volume (in mm<sup>3</sup> ). Variables <span class="math notranslate nohighlight">\(x_3\)</span> and <span class="math notranslate nohighlight">\(x_4\)</span> correspond to the drug levels (in mg/kg) in the central and peripheral compartments, respectively.</p>
<p>The model incorporates the following dynamics:</p>
<ul class="simple">
<li><p>Tumor cells proliferate at a known duplication rate (<span class="math notranslate nohighlight">\(a\)</span>).</p></li>
<li><p>Tumor cells undergo spontaneous necrosis at a rate (<span class="math notranslate nohighlight">\(n\)</span>) independent of the drug level.</p></li>
<li><p>Tumor cells convert into necrotic cells based on the drug level (<span class="math notranslate nohighlight">\(x_3\)</span>) and the drug’s specific properties (explained below).</p></li>
<li><p>Necrotic cells are removed from the tissue (washout) at a known rate (<span class="math notranslate nohighlight">\(w\)</span>).</p></li>
<li><p>The drug is administered instantaneously, resulting in an immediate change to the level of <span class="math notranslate nohighlight">\(x_3\)</span>.</p></li>
<li><p>The drug is distributed between the two compartments, with transport governed by rates <span class="math notranslate nohighlight">\(k_1\)</span> (central to peripheral) and <span class="math notranslate nohighlight">\(k_2\)</span> (peripheral to central).</p></li>
</ul>
<p><a class="reference internal" href="#figure1"><span class="std std-numref">Fig. 1</span></a> shows a representative in vivo experimental result. The red dots represent the measured data series obtained by regularly monitoring the size (volume) of the tumor tissue implanted in the mouse.</p>
<p>By appropriately selecting the model parameters (fitting the model) and accounting for the treatment effects, this ODE model approximates the observed dynamics in reality: the rapidly growing tumor without treatment, followed by the volume decrease due to the treatment, which is explained by the death and clearance of the tumor tissue cells. After treatment, the drug is continuously cleared, thus its effect diminishes, leading to tumor regrowth.</p>
<figure class="align-default" id="id1">
<span id="figure1"></span><img alt="../../_images/Figure_1.png" src="../../_images/Figure_1.png" />
<figcaption>
<p><span class="caption-number">Fig. 1 </span><span class="caption-text">Actual tumor volumes measured during an experiment (red dots) and the simulated volumes obtained after fitting the model (blue line). The times of drug treatments are indicated by black arrows. (Re-plotted from data in <a class="reference internal" href="#ref-drexler2020"><span class="std std-ref">Drexler et al. (2020)</span></a>.)</span><a class="headerlink" href="#id1" title="Link to this image">#</a></p>
</figcaption>
</figure>
</section>
<section id="lattics-implementation">
<h2>LattiCS implementation<a class="headerlink" href="#lattics-implementation" title="Link to this heading">#</a></h2>
<p>The presented experiment will be implemented in LattiCS in two distinct forms: first, using a homogeneous simulation space similar to the ODE model (which allows for fast simulation runs and can serve as a surrogate model for parameter estimation), and subsequently, using a three-dimensional simulation space.</p>
<p>Following the selection of the simulation space, the model setup will proceed in two major steps: first, tuning the parameters of the drug introduced during the treatments, and subsequently, adding the agents that describe the tumor tissue cells to the model.</p>
<section id="initial-steps">
<h3>Initial steps<a class="headerlink" href="#initial-steps" title="Link to this heading">#</a></h3>
<p>First, we load the <code class="docutils literal notranslate"><span class="pre">lattics</span></code> package and create a <code class="docutils literal notranslate"><span class="pre">Simulation</span></code> object and a <code class="docutils literal notranslate"><span class="pre">HomogeneousSpace</span></code> object. We use a 1-hour time step for the agents’ simulation and a 30-second time step for the substrate (drug) simulation.</p>
<p>For practical reasons, the volume of the simulation space is set to 2.7 × 10<sup>7</sup> μm<sup>3</sup> (corresponding to a virtual cubic space of 300 μm × 300 μm × 300 μm). This choice primarily determines the maximum cell capacity, thus influencing the simulation speed. Given the agent volumes (see below), this space will accommodate a maximum of 8000 agents, a simulation that should take no more than a few minutes on an average personal computer.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">lattics</span>

<span class="n">simulation</span> <span class="o">=</span> <span class="n">lattics</span><span class="o">.</span><span class="n">Simulation</span><span class="p">()</span>
<span class="n">space</span> <span class="o">=</span> <span class="n">lattics</span><span class="o">.</span><span class="n">HomogeneousSpace</span><span class="p">(</span>
        <span class="n">simulation</span><span class="o">=</span><span class="n">simulation</span><span class="p">,</span>
        <span class="n">dt_agent</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;hour&#39;</span><span class="p">),</span>
        <span class="n">dt_substrate</span><span class="o">=</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="s1">&#39;sec&#39;</span><span class="p">),</span>
        <span class="n">volume</span><span class="o">=</span><span class="mf">2.7</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="mi">7</span>
        <span class="p">)</span>
<span class="n">simulation</span><span class="o">.</span><span class="n">add_space</span><span class="p">(</span><span class="n">space</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="the-pharmacokinetics-of-the-drug">
<h3>The pharmacokinetics of the drug<a class="headerlink" href="#the-pharmacokinetics-of-the-drug" title="Link to this heading">#</a></h3>
<p>In the animal experiments, the drug is administered to the subjects as a bolus injection, which causes its concentration in the blood to instantaneously increase, followed by distribution into the tissues and subsequent elimination (or degradation) over time. The ODE model describes the drug concentration within two compartments (tumor tissue and organs). This two-compartment approach allows the model to more accurately describe the measurable concentrations observed in vivo following treatment.</p>
<p>We now incorporate a substrate named “drug” into the simulation space. When creating the substrate, we must specify the diffusion coefficient and the decay coefficient describing spontaneous degradation of the substrate. Although diffusion will not be simulated in the homogeneous space, the diffusion coefficient can still be set here and will be required during the three-dimensional simulation. Based on literature data regarding the typical size of PLD nanoparticles (on the order of 100 nm), we will set the substrate’s diffusion coefficient to 2 × 10<sup>-3</sup> μm<sup>2</sup>/ms (<a class="reference internal" href="#ref-lee2021"><span class="std std-ref">Lee et al. (2021)</span></a> and <a class="reference internal" href="#ref-schleyer2024"><span class="std std-ref">Schleyer et al. (2024)</span></a>). Since the decay rate will be determined experimentally (see below), we will set it to an arbitrary placeholder value (e.g., 0.0) for now.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">space</span><span class="o">.</span><span class="n">add_substrate</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;drug&#39;</span><span class="p">,</span>
        <span class="n">diffusion_coefficient</span><span class="o">=</span><span class="mf">2e-3</span><span class="p">,</span>
        <span class="n">decay_coefficient</span><span class="o">=</span><span class="mf">0.0</span>
        <span class="p">)</span>
</pre></div>
</div>
<p>In our approach, the simulation space represents the tissue surrounding the tumor, into which the drug is delivered by the blood vessels running through it. In this context, the blood vessels are considered the sources of the drug; locations where the drug concentration increases following treatment, and from which the drug subsequently diffuses to other parts of the tissue. In LattiCS, these sources can be represented by <code class="docutils literal notranslate"><span class="pre">SubstrateNode</span></code> objects, for which we can specify the internal drug concentration and the characteristics of transport (uptake-release) with the surrounding environment.</p>
<p>Since the location, shape, and distribution of the vessels cannot be accounted for in a homogeneous space, we will now create a single <code class="docutils literal notranslate"><span class="pre">SubstrateNode</span></code> object to represent all blood vessels within the tissue. Based on literature data, the typical blood volume fraction in tissues is 5-15% (<a class="reference internal" href="#ref-claridge2007"><span class="std std-ref">Claridge et al. (2007)</span></a> and <a class="reference internal" href="#ref-qi2008"><span class="std std-ref">Qi et al. (2008)</span></a>). Accordingly, we will select 10% of the previously created space volume as the virtual volume for this <code class="docutils literal notranslate"><span class="pre">SubstrateNode</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">blood_vessels</span> <span class="o">=</span> <span class="n">lattics</span><span class="o">.</span><span class="n">SubstrateNode</span><span class="p">()</span>
<span class="n">blood_vessels</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s1">&#39;volume&#39;</span><span class="p">,</span> <span class="mf">2.7</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="mi">6</span><span class="p">)</span>
</pre></div>
</div>
<p>When modeling the transport from the node to the surrounding tissue (space), three types of parameters can be specified to describe the process. For simplicity, we model this process by assuming that the drug moves between the vessels and the tissue at a rate proportional to the concentration difference; therefore, we will only set the parameter for the passive transport rate for the <code class="docutils literal notranslate"><span class="pre">SubstrateNode</span></code> (the other values will remain zero).</p>
<p>We hypothesize that this process occurs relatively quickly, so we set the rate value to a high value (10<sup>-3</sup> 1/ms), and the initial drug concentration to zero, which will increase as a result of the treatments.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">blood_vessel_transport_info</span> <span class="o">=</span> <span class="n">lattics</span><span class="o">.</span><span class="n">SubstrateInfo</span><span class="p">(</span>
        <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;flux&#39;</span><span class="p">,</span>
        <span class="n">concentration</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="n">passive_rate</span><span class="o">=</span><span class="mf">1e-3</span>
        <span class="p">)</span>
<span class="n">blood_vessels</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;substrate_info&#39;</span><span class="p">)[</span><span class="s1">&#39;drug&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">blood_vessel_transport_info</span>
<span class="n">space</span><span class="o">.</span><span class="n">_substrates</span><span class="p">[</span><span class="s1">&#39;drug&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add_static_substrate_node</span><span class="p">(</span><span class="n">blood_vessels</span><span class="p">)</span>
</pre></div>
</div>
<p>To account for the organs acting as a drug reservoir (“buffering effect”) the ODE model introduces a second compartment. We model this using a second <code class="docutils literal notranslate"><span class="pre">SubstrateNode</span></code> object, where the initial concentration is also zero, and which changes due to bi-directional transfer with the simulation space. For simplicity, we set its virtual volume to be equal to that of the original simulation space (however, this has no direct role, as the same dynamic can be achieved with a node of different virtual volume by appropriately choosing the transport rate constants due to the form of the transport equations). The <code class="docutils literal notranslate"><span class="pre">release_rate</span></code> and <code class="docutils literal notranslate"><span class="pre">uptake_rate</span></code> map directly to the ODE model’s <span class="math notranslate nohighlight">\(k_1\)</span> and <span class="math notranslate nohighlight">\(k_2\)</span> rate constants; however, they require subsequent fine-tuning (see below), and we set a placeholder value now.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">organs</span> <span class="o">=</span> <span class="n">lattics</span><span class="o">.</span><span class="n">SubstrateNode</span><span class="p">()</span>
<span class="n">organs</span><span class="o">.</span><span class="n">set_attribute</span><span class="p">(</span><span class="s1">&#39;volume&#39;</span><span class="p">,</span> <span class="mf">2.7</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="mi">7</span><span class="p">)</span>
<span class="n">organs_transport_info</span> <span class="o">=</span> <span class="n">lattics</span><span class="o">.</span><span class="n">SubstrateInfo</span><span class="p">(</span>
        <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;flux&#39;</span><span class="p">,</span>
        <span class="n">concentration</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="n">release_rate</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
        <span class="n">uptake_rate</span><span class="o">=</span><span class="mf">0.0</span>
<span class="p">)</span>
<span class="n">organs</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s1">&#39;substrate_info&#39;</span><span class="p">)[</span><span class="s1">&#39;drug&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">organs_transport_info</span>
<span class="n">space</span><span class="o">.</span><span class="n">_substrates</span><span class="p">[</span><span class="s1">&#39;drug&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">add_static_substrate_node</span><span class="p">(</span><span class="n">organs</span><span class="p">)</span>
</pre></div>
</div>
<p><a class="reference internal" href="#figure2"><span class="std std-numref">Fig. 2</span></a> summarizes the structure of the constructed pharmacokinetic model. The blue node represents the simulation space, which defines the drug concentration within the tissue, and is the environment from which the substrate (drug) enters the tumor cells. During treatment, the drug is introduced into the red node, which models the blood vessels, and is subsequently transferred to the tissue in a concentration-dependent manner. The gray node models the buffering effect of the organs, with the substrate flow rates between this organ compartment and the tissue regulated by the <span class="math notranslate nohighlight">\(k_u\)</span> and <span class="math notranslate nohighlight">\(k_r\)</span> parameters.</p>
<figure class="align-center" id="id2">
<span id="figure2"></span><a class="reference internal image-reference" href="../../_images/Figure_2.png"><img alt="../../_images/Figure_2.png" src="../../_images/Figure_2.png" style="width: 400px;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 2 </span><span class="caption-text">Schematic of the constructed pharmacokinetic model.</span><a class="headerlink" href="#id2" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>For the calibration of the aforementioned parameters (the drug’s decay coefficient and the transport rates between the tissue and the organs), we utilize one of the data sets published in <a class="reference internal" href="#ref-drexler2020"><span class="std std-ref">Drexler et al. (2020)</span></a>.</p>
<p><a class="reference internal" href="#figure3"><span class="std std-numref">Fig. 3</span></a> shows the drug concentrations measured in one of the mouse’s blood over time following a single 8 mg/kg bolus injection.</p>
<figure class="align-default" id="id3">
<span id="figure3"></span><img alt="../../_images/Figure_3.png" src="../../_images/Figure_3.png" />
<figcaption>
<p><span class="caption-number">Fig. 3 </span><span class="caption-text">Time course of drug concentration measured in blood. (Re-plotted from data in <a class="reference internal" href="#ref-drexler2020"><span class="std std-ref">Drexler et al. (2020)</span></a>.)</span><a class="headerlink" href="#id3" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>The treatment is represented by an <code class="docutils literal notranslate"><span class="pre">Event</span></code> object in our LattiCS model. This event will be scheduled immediately at the start of the simulation and will trigger a change in the concentration of the substrate named “drug” to a specified value (which is also a placeholder value here).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">treatment_1</span> <span class="o">=</span> <span class="n">lattics</span><span class="o">.</span><span class="n">Event</span><span class="p">(</span>
        <span class="n">time</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;sec&#39;</span><span class="p">),</span>
        <span class="n">handler</span><span class="o">=</span><span class="n">set_substrate_level</span><span class="p">,</span>
        <span class="n">concentration</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;drug&#39;</span>
        <span class="p">)</span>
<span class="n">simulation</span><span class="o">.</span><span class="n">add_event</span><span class="p">(</span><span class="n">treatment_1</span><span class="p">)</span>
</pre></div>
</div>
<p>Our model is now ready to be executed and the resulting data retrieved. Consistent with the measurement data shown in <a class="reference internal" href="#figure3"><span class="std std-numref">Fig. 3</span></a>, we will simulate a 5-day duration, using the previously set 30-second time step for the substrate. Data logs of the simulation will be stored after every 10 simulated minutes, but the data will only be written to a file upon completion (for a short simulation like this, continuous file writing could slow down the execution).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">simulation</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
        <span class="n">time</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;day&#39;</span><span class="p">),</span>
        <span class="n">dt</span><span class="o">=</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="s1">&#39;sec&#39;</span><span class="p">),</span>
        <span class="n">dt_history</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;min&#39;</span><span class="p">),</span>
        <span class="n">save_mode</span><span class="o">=</span><span class="s1">&#39;on_completion&#39;</span>
        <span class="p">)</span>
</pre></div>
</div>
<p>After plotting the concentration profile established in the simulation space, it is clear that the model parameters require refinement, as the simulated data set deviates significantly from the real data. Although this calibration could be performed using any of the well-established parameter fitting routines, we instead employ an “eyeballing” approach here to heuristically tune the model’s parameters and gain a better understanding of their sensitivity and impact on the system dynamics.</p>
<p>In the simulated data, the drug concentration settles to an equilibrium value after a long period (meaning the drug is transferred from the blood vessels into the tissues). However, this equilibrium concentration is orders of magnitude lower than the initial drug concentration observed in reality, and the steady-state is reached too slowly. Let’s first modify the <code class="docutils literal notranslate"><span class="pre">concentration</span></code> value within the <code class="docutils literal notranslate"><span class="pre">Event</span></code> representing the treatment so that the resulting equilibrium concentration roughly matches the initial value of the real data set (10<sup>6</sup> is an approximately good choice).</p>
<p>Next, we modify the rate of transfer from the blood vessel node into the tissues by increasing the <code class="docutils literal notranslate"><span class="pre">passive_rate</span></code> parameter stored in the <code class="docutils literal notranslate"><span class="pre">blood_vessel_transport_info</span></code> variable (5 × 10<sup>-1</sup> is an approximately good choice). Following these changes, the simulated drug concentration in the tissues will approach the initial value of the real data set, but the elimination dynamics still remain unrealistic.</p>
<p>In our model, the drug can leave the system due to decay, the rate of which was set during the substrate creation. Let’s modify the <code class="docutils literal notranslate"><span class="pre">decay_coefficient</span></code> and set a small but non-zero value (e.g., 10<sup>-8</sup>). As a result, the trend of the simulated curve begins to resemble that of the measured data; however, the dynamics are still not perfect (in our model, decay is a first-order reaction, meaning the concentration decreases exponentially, whereas in the real data set, the elimination rate gradually slows).</p>
<p>Let us now set the <code class="docutils literal notranslate"><span class="pre">release_rate</span></code> and <code class="docutils literal notranslate"><span class="pre">uptake_rate</span></code> values stored in the <code class="docutils literal notranslate"><span class="pre">organs_transport_info</span></code> variable. We set the rate of uptake (flow from tissues to organs) greater than the rate of release (e.g., 1.0 and 10.0, respectively). Due to this change, the characteristic change in drug concentration begins to follow the trend of the real data set. Further adjustments to these parameters can quickly yield an adequate approximation.</p>
<figure class="align-default" id="id4">
<span id="figure8"></span><img alt="../../_images/Figure_8.png" src="../../_images/Figure_8.png" />
<figcaption>
<p><span class="caption-number">Fig. 4 </span><span class="caption-text">Simulated time course of drug concentration after parameter estimation.</span><a class="headerlink" href="#id4" title="Link to this image">#</a></p>
</figcaption>
</figure>
</section>
<section id="tumor-growth">
<h3>Tumor growth<a class="headerlink" href="#tumor-growth" title="Link to this heading">#</a></h3>
</section>
</section>
<section id="references">
<h2>References<a class="headerlink" href="#references" title="Link to this heading">#</a></h2>
<p id="ref-drexler2020"><cite>Drexler et al. (2020)</cite> Dániel András Drexler, Tamás Ferenci, András Füredi, Gergely Szakács, Levente Kovács, “Experimental data-driven tumor modeling for chemotherapy”,
IFAC-PapersOnLine, Volume 53, Issue 2, 2020, Pages 16245-16250, ISSN 2405-8963; <a class="reference external" href="https://doi.org/10.1016/j.ifacol.2020.12.619">https://doi.org/10.1016/j.ifacol.2020.12.619</a></p>
<p id="ref-claridge2007"><cite>Claridge et al. (2007)</cite> Ela Claridge, Džena Hidović-Rowe, Phillipe Taniere, Tariq Ismail, “Quantifying mucosal blood volume fraction from multispectral images of the colon”, Proc. SPIE 6511, Medical Imaging 2007: Physiology, Function, and Structure from Medical Images, 65110C (29 March 2007); <a class="reference external" href="https://doi.org/10.1117/12.709559">https://doi.org/10.1117/12.709559</a></p>
<p id="ref-qi2008"><cite>Qi et al. (2008)</cite> Xiu-Ling Qi, Peter Burns, Juimiin Hong, Jeff Stainsby, Graham Wright, “Characterizing blood volume fraction (BVF) in a VX2 tumor”, Magnetic Resonance Imaging, Volume 26, Issue 2, 2008, Pages 206-214, ISSN 0730-725X; <a class="reference external" href="https://doi.org/10.1016/j.mri.2007.05.010">https://doi.org/10.1016/j.mri.2007.05.010</a></p>
<p id="ref-lee2021"><cite>Lee et al. (2021)</cite> Benjamin J. Lee, Yahya Cheema, Shahed Bader, Gregg A. Duncan, “Shaping nanoparticle diffusion through biological barriers to drug delivery”, JCIS Open, Volume 4, 2021, 100025, ISSN 2666-934X; <a class="reference external" href="https://doi.org/10.1016/j.jciso.2021.100025">https://doi.org/10.1016/j.jciso.2021.100025</a></p>
<p id="ref-schleyer2024"><cite>Schleyer et al. (2024)</cite> Genevieve Schleyer, Eann A. Patterson, and Judith M. Curran, “Label free tracking to quantify nanoparticle diffusion through biological media”, Sci Rep 14, 18822 (2024); <a class="reference external" href="https://doi.org/10.1038/s41598-024-69506-0">https://doi.org/10.1038/s41598-024-69506-0</a></p>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../main.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Examples</p>
      </div>
    </a>
    <a class="right-next"
       href="../../learn/main.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Learn about the methods behind LattiCS</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#background">Background</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lattics-implementation">LattiCS implementation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#initial-steps">Initial steps</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-pharmacokinetics-of-the-drug">The pharmacokinetics of the drug</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#tumor-growth">Tumor growth</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/examples/drug_treatment/drug_treatment.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2025, Daniel Kiss.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.2.3.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>